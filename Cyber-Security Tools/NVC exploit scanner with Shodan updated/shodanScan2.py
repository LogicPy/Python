import shodan
import random
import logging
import time

# Configure logging
logging.basicConfig(
    filename="cybersecurity_scanner.log",
    filemode="w",
    level=logging.INFO,
    format="%(asctime)s - %(levelname)s - %(message)s"
)

# Shodan API key
SHODAN_API_KEY = "GMajjWp1CFpmCWCVDAKrfDaVSv2XITccksmSXEtrDi4k41DtjeGF8uMEsldxUq9e"
api = shodan.Shodan(SHODAN_API_KEY)

import requests
import random
from shodan import Shodan

# Shodan API Key
SHODAN_API_KEY = "GMajjWp1CFpmCWCVDAKrfDaVSv2XITccksmSXEtrDi4k41DtjeGF8uMEsldxUq9e"
shodan_client = Shodan(SHODAN_API_KEY)

# NVD API Key (https://www.devglan.com/)
NVD_API_KEY = "cw9uTkVlxpAF4dtB8Qw7UaFTG8BIXe0BCjn4QB3xR/z9mnhtPs5p4IWJq6+ygmfL"

import requests
import json
from urllib.parse import urljoin
import random
import string

# Shodan and NVD API keys
SHODAN_API_KEY = "GMajjWp1CFpmCWCVDAKrfDaVSv2XITccksmSXEtrDi4k41DtjeGF8uMEsldxUq9e"
NVD_API_KEY = "cw9uTkVlxpAF4dtB8Qw7UaFTG8BIXe0BCjn4QB3xR/z9mnhtPs5p4IWJq6+ygmfL"

import requests
import json
import random

# API keys
SHODAN_API_KEY = "GMajjWp1CFpmCWCVDAKrfDaVSv2XITccksmSXEtrDi4k41DtjeGF8uMEsldxUq9e"
NVD_API_KEY = "cw9uTkVlxpAF4dtB8Qw7UaFTG8BIXe0BCjn4QB3xR/z9mnhtPs5p4IWJq6+ygmfL"

# API URLs
SHODAN_HOST_SEARCH_URL = "https://api.shodan.io/shodan/host/"
NVD_API_URL = "https://services.nvd.nist.gov/rest/json/cves/2.0"

# Randomly generate IP addresses
def random_ip():
    return ".".join(str(random.randint(1, 255)) for _ in range(4))

# Perform a Shodan scan
def shodan_scan(ip):
    print(f"Scanning IP: {ip}")
    try:
        response = requests.get(
            f"{SHODAN_HOST_SEARCH_URL}{ip}",
            params={"key": SHODAN_API_KEY},
            timeout=10,
        )
        response.raise_for_status()
        data = response.json()
        print(f"Shodan scan result for {ip}: {json.dumps(data, indent=2)}")
        return data.get("vulns", [])
    except requests.RequestException as e:
        print(f"Error scanning IP {ip}: {e}")
        return []

# Fetch CVE details from NVD API
def fetch_cve_details(cve_id):
    print(f"Fetching details for CVE: {cve_id}")
    headers = {"apiKey": NVD_API_KEY}
    params = {"cveId": cve_id}
    try:
        response = requests.get(NVD_API_URL, headers=headers, params=params, timeout=10)
        response.raise_for_status()
        data = response.json()
        vulnerabilities = data.get("vulnerabilities", [])
        if vulnerabilities:
            for vuln in vulnerabilities:
                cve_data = vuln.get("cve", {})
                description = cve_data.get("descriptions", [{}])[0].get("value", "No description available")
                print(f"- {cve_id}: {description}")
        else:
            print(f"No details found for CVE: {cve_id}")
    except requests.RequestException as e:
        print(f"Error fetching CVE details for {cve_id}: {e}")

# Main function with customizable scan limit
def main():
    num_ips_to_scan = int(input("Enter the number of servers to scan: "))
    for _ in range(num_ips_to_scan):
        ip = random_ip()
        vulns = shodan_scan(ip)  # Get vulnerabilities from Shodan
        if vulns:
            print(f"Vulnerabilities found for {ip}: {vulns}")
            for cve in vulns:
                fetch_cve_details(cve)  # Fetch CVE details from NVD
        else:
            print(f"No vulnerabilities found for {ip}")

if __name__ == "__main__":
    main()
